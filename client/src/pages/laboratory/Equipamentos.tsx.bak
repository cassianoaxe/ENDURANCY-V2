import React, { useState, useEffect } from 'react';
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle
} from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow
} from '@/components/ui/table';
import { Badge } from '@/components/ui/badge';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger
} from '@/components/ui/dialog';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Label } from '@/components/ui/label';
import {
  AlertCircle,
  Calendar,
  Download,
  Edit,
  Eye,
  Filter,
  Microscope,
  Plus,
  Search,
  Wrench
} from 'lucide-react';
import { useToast } from '@/hooks/use-toast';

// Interfaces
interface Equipment {
  id: number;
  name: string;
  type: string;
  model: string;
  serialNumber: string;
  manufacturer: string;
  acquisitionDate: string;
  lastCalibration: string;
  nextCalibration: string;
  lastMaintenance: string;
  nextMaintenance: string;
  location: string;
  status: 'operational' | 'maintenance' | 'calibration' | 'out_of_service' | 'repair';
  responsible: string;
  notes?: string;
}

interface MaintenanceRecord {
  id: number;
  equipmentId: number;
  date: string;
  type: 'calibration' | 'preventive' | 'corrective' | 'validation';
  description: string;
  technician: string;
  status: 'scheduled' | 'in_progress' | 'completed' | 'canceled';
  cost?: number;
  nextDate?: string;
  attachments?: string[];
  notes?: string;
}

export default function EquipamentosPage() {
  const [equipments, setEquipments] = useState<Equipment[]>([]);
  const [maintenanceRecords, setMaintenanceRecords] = useState<MaintenanceRecord[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedType, setSelectedType] = useState<string>('all');
  const [selectedStatus, setSelectedStatus] = useState<string>('all');
  const [showNewEquipmentDialog, setShowNewEquipmentDialog] = useState(false);
  const [showEquipmentDetailDialog, setShowEquipmentDetailDialog] = useState(false);
  const [showNewMaintenanceDialog, setShowNewMaintenanceDialog] = useState(false);
  const [selectedEquipment, setSelectedEquipment] = useState<Equipment | null>(null);
  const [activeTab, setActiveTab] = useState('all');
  const { toast } = useToast();

  // Carregar dados
  useEffect(() => {
    const fetchEquipments = async () => {
      try {
        setIsLoading(true);
        // Na implementa√ß√£o real, isso seria uma chamada √† API
        // const response = await fetch('/api/laboratory/equipments');
        // const data = await response.json();
        // setEquipments(data);
        
        // Simula√ß√£o com dados fict√≠cios para desenvolvimento
        setTimeout(() => {
          setEquipments(mockEquipments);
          setMaintenanceRecords(mockMaintenanceRecords);
          setIsLoading(false);
        }, 800);
      } catch (error) {
        console.error('Erro ao buscar equipamentos:', error);
        toast({
          title: 'Erro',
          description: 'N√£o foi poss√≠vel carregar a lista de equipamentos.',
          variant: 'destructive',
        });
        setIsLoading(false);
      }
    };

    fetchEquipments();
  }, [toast]);

  // Filtrar equipamentos
  const filteredEquipments = equipments.filter(equipment => {
    // Filtro de busca por nome, modelo ou n√∫mero de s√©rie
    const matchesSearch = 
      searchQuery === '' || 
      equipment.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      equipment.model.toLowerCase().includes(searchQuery.toLowerCase()) ||
      equipment.serialNumber.toLowerCase().includes(searchQuery.toLowerCase());
    
    // Filtro por tipo
    const matchesType = 
      selectedType === 'all' || 
      equipment.type === selectedType;
    
    // Filtro por status
    const matchesStatus = 
      selectedStatus === 'all' || 
      equipment.status === selectedStatus;
    
    // Filtro por tab
    if (activeTab === 'maintenance') {
      // Considerar equipamentos que precisam de manuten√ß√£o nos pr√≥ximos 30 dias
      const nextMaintenanceDate = new Date(equipment.nextMaintenance);
      const thirtyDaysFromNow = new Date();
      thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);
      return matchesSearch && matchesType && matchesStatus && nextMaintenanceDate <= thirtyDaysFromNow;
    } else if (activeTab === 'calibration') {
      // Considerar equipamentos que precisam de calibra√ß√£o nos pr√≥ximos 30 dias
      const nextCalibrationDate = new Date(equipment.nextCalibration);
      const thirtyDaysFromNow = new Date();
      thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);
      return matchesSearch && matchesType && matchesStatus && nextCalibrationDate <= thirtyDaysFromNow;
    }
    
    return matchesSearch && matchesType && matchesStatus;
  });

  // Filtrar registros de manuten√ß√£o para o equipamento selecionado
  const equipmentMaintenanceRecords = selectedEquipment 
    ? maintenanceRecords.filter(record => record.equipmentId === selectedEquipment.id)
    : [];

  // Fun√ß√£o para visualizar detalhes do equipamento
  const viewEquipmentDetails = (equipment: Equipment) => {
    setSelectedEquipment(equipment);
    setShowEquipmentDetailDialog(true);
  };

  // Fun√ß√£o para adicionar novo equipamento
  const handleAddEquipment = (e: React.FormEvent) => {
    e.preventDefault();
    toast({
      title: 'Equipamento Adicionado',
      description: 'O novo equipamento foi registrado com sucesso.',
    });
    setShowNewEquipmentDialog(false);
  };

  // Fun√ß√£o para adicionar novo registro de manuten√ß√£o
  const handleAddMaintenance = (e: React.FormEvent) => {
    e.preventDefault();
    toast({
      title: 'Manuten√ß√£o Agendada',
      description: 'O novo registro de manuten√ß√£o foi adicionado com sucesso.',
    });
    setShowNewMaintenanceDialog(false);
  };

  // Fun√ß√£o para calcular status de alerta com base nas datas
  const getMaintenanceAlertStatus = (nextDate: string) => {
    const today = new Date();
    const dateToCheck = new Date(nextDate);
    const diffTime = dateToCheck.getTime() - today.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays < 0) {
      return 'overdue';
    } else if (diffDays <= 7) {
      return 'critical';
    } else if (diffDays <= 30) {
      return 'warning';
    } else {
      return 'normal';
    }
  };

  // Fun√ß√£o para traduzir o tipo de equipamento
  const translateEquipmentType = (type: string) => {
    const typeMap: Record<string, string> = {
      'hplc': 'HPLC',
      'gc': 'Cromat√≥grafo de G√°s',
      'spectrometer': 'Espectr√¥metro',
      'scale': 'Balan√ßa',
      'microscope': 'Microsc√≥pio',
      'centrifuge': 'Centr√≠fuga',
      'other': 'Outro'
    };
    return typeMap[type] || type;
  };

  // Fun√ß√£o para traduzir o status do equipamento
  const translateEquipmentStatus = (status: string) => {
    const statusMap: Record<string, string> = {
      'operational': 'Operacional',
      'maintenance': 'Em Manuten√ß√£o',
      'calibration': 'Em Calibra√ß√£o',
      'out_of_service': 'Fora de Servi√ßo',
      'repair': 'Em Reparo'
    };
    return statusMap[status] || status;
  };

  // Fun√ß√£o para obter a cor do status
  const getStatusColor = (status: string) => {
    const colorMap: Record<string, string> = {
      'operational': 'bg-green-500 hover:bg-green-600',
      'maintenance': 'bg-yellow-500 hover:bg-yellow-600',
      'calibration': 'bg-blue-500 hover:bg-blue-600',
      'out_of_service': 'bg-red-500 hover:bg-red-600',
      'repair': 'bg-orange-500 hover:bg-orange-600'
    };
    return colorMap[status] || 'bg-gray-500 hover:bg-gray-600';
  };

  // Fun√ß√£o para obter a cor do alerta de manuten√ß√£o
  const getAlertColor = (status: string) => {
    const colorMap: Record<string, string> = {
      'overdue': 'bg-red-500 hover:bg-red-600',
      'critical': 'bg-orange-500 hover:bg-orange-600',
      'warning': 'bg-yellow-500 hover:bg-yellow-600',
      'normal': 'bg-green-500 hover:bg-green-600'
    };
    return colorMap[status] || 'bg-blue-500 hover:bg-blue-600';
  };

  // Fun√ß√£o para traduzir o tipo de manuten√ß√£o
  const translateMaintenanceType = (type: string) => {
    const typeMap: Record<string, string> = {
      'calibration': 'Calibra√ß√£o',
      'preventive': 'Preventiva',
      'corrective': 'Corretiva',
      'validation': 'Valida√ß√£o'
    };
    return typeMap[type] || type;
  };

  // Fun√ß√£o para traduzir o status da manuten√ß√£o
  const translateMaintenanceStatus = (status: string) => {
    const statusMap: Record<string, string> = {
      'scheduled': 'Agendada',
      'in_progress': 'Em Andamento',
      'completed': 'Conclu√≠da',
      'canceled': 'Cancelada'
    };
    return statusMap[status] || status;
  };

  // Renderiza√ß√£o do estado de carregamento
  if (isLoading) {
    return (
        <div className="flex justify-center items-center h-[calc(100vh-150px)]">
          <div className="flex flex-col items-center">
            <Microscope className="h-12 w-12 animate-pulse text-blue-500 mb-2" />
            <p className="text-lg text-gray-600">Carregando equipamentos...</p>
          </div>
        </div>
    );
  }

  return (
      <div className="space-y-4 p-6">
        <div className="flex justify-between items-center">
          <h1 className="text-2xl font-bold">Gerenciamento de Equipamentos</h1>
          <Button onClick={() => setShowNewEquipmentDialog(true)}>
            <Plus className="h-4 w-4 mr-2" />
            Novo Equipamento
          </Button>
        </div>

        <Card>
          <CardHeader className="pb-3">
            <CardTitle>Equipamentos do Laborat√≥rio</CardTitle>
            <CardDescription>
              Gerencie os equipamentos, calibra√ß√µes e manuten√ß√µes
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Tabs defaultValue={activeTab} onValueChange={setActiveTab} className="mb-6">
              <TabsList>
                <TabsTrigger value="all">Todos</TabsTrigger>
                <TabsTrigger value="maintenance">Pr√≥ximas Manuten√ß√µes</TabsTrigger>
                <TabsTrigger value="calibration">Pr√≥ximas Calibra√ß√µes</TabsTrigger>
              </TabsList>
            </Tabs>

            <div className="flex flex-col md:flex-row justify-between gap-4 mb-6">
              <div className="relative w-full md:w-auto flex-1">
                <Search className="absolute left-2 top-2.5 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Buscar por nome ou modelo..."
                  className="pl-8"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                />
              </div>

              <div className="flex flex-col sm:flex-row gap-2">
                <div className="flex items-center space-x-2">
                  <Filter className="h-4 w-4 text-gray-400" />
                  <Select
                    value={selectedType}
                    onValueChange={setSelectedType}
                  >
                    <SelectTrigger className="w-[180px]">
                      <SelectValue placeholder="Tipo" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="all">Todos os Tipos</SelectItem>
                      <SelectItem value="hplc">HPLC</SelectItem>
                      <SelectItem value="gc">Cromat√≥grafo de G√°s</SelectItem>
                      <SelectItem value="spectrometer">Espectr√¥metro</SelectItem>
                      <SelectItem value="scale">Balan√ßa</SelectItem>
                      <SelectItem value="microscope">Microsc√≥pio</SelectItem>
                      <SelectItem value="centrifuge">Centr√≠fuga</SelectItem>
                      <SelectItem value="other">Outro</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                <div className="flex items-center space-x-2">
                  <Filter className="h-4 w-4 text-gray-400" />
                  <Select
                    value={selectedStatus}
                    onValueChange={setSelectedStatus}
                  >
                    <SelectTrigger className="w-[180px]">
                      <SelectValue placeholder="Status" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="all">Todos os Status</SelectItem>
                      <SelectItem value="operational">Operacional</SelectItem>
                      <SelectItem value="maintenance">Em Manuten√ß√£o</SelectItem>
                      <SelectItem value="calibration">Em Calibra√ß√£o</SelectItem>
                      <SelectItem value="out_of_service">Fora de Servi√ßo</SelectItem>
                      <SelectItem value="repair">Em Reparo</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>
            </div>

            <div className="rounded-md border">
              <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>Nome</TableHead>
                    <TableHead>Tipo</TableHead>
                    <TableHead className="hidden md:table-cell">Modelo</TableHead>
                    <TableHead className="hidden lg:table-cell">Pr√≥x. Manuten√ß√£o</TableHead>
                    <TableHead className="hidden lg:table-cell">Pr√≥x. Calibra√ß√£o</TableHead>
                    <TableHead>Status</TableHead>
                    <TableHead className="text-right">A√ß√µes</TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {filteredEquipments.length === 0 ? (
                    <TableRow>
                      <TableCell colSpan={7} className="h-24 text-center">
                        Nenhum equipamento encontrado com os filtros atuais.
                      </TableCell>
                    </TableRow>
                  ) : (
                    filteredEquipments.map((equipment) => {
                      const maintenanceAlertStatus = getMaintenanceAlertStatus(equipment.nextMaintenance);
                      const calibrationAlertStatus = getMaintenanceAlertStatus(equipment.nextCalibration);
                      
                      return (
                        <TableRow key={equipment.id}>
                          <TableCell className="font-medium">
                            {equipment.name}
                          </TableCell>
                          <TableCell>{translateEquipmentType(equipment.type)}</TableCell>
                          <TableCell className="hidden md:table-cell">
                            <div>
                              {equipment.model}
                              <div className="text-xs text-gray-500">
                                SN: {equipment.serialNumber}
                              </div>
                            </div>
                          </TableCell>
                          <TableCell className="hidden lg:table-cell">
                            <div className="flex items-center">
                              <Badge 
                                className={getAlertColor(maintenanceAlertStatus)}
                                variant="outline"
                              >
                                {new Date(equipment.nextMaintenance).toLocaleDateString('pt-BR')}
                              </Badge>
                              {maintenanceAlertStatus === 'overdue' && (
                                <AlertCircle className="h-4 w-4 ml-1 text-red-500" />
                              )}
                            </div>
                          </TableCell>
                          <TableCell className="hidden lg:table-cell">
                            <div className="flex items-center">
                              <Badge 
                                className={getAlertColor(calibrationAlertStatus)}
                                variant="outline"
                              >
                                {new Date(equipment.nextCalibration).toLocaleDateString('pt-BR')}
                              </Badge>
                              {calibrationAlertStatus === 'overdue' && (
                                <AlertCircle className="h-4 w-4 ml-1 text-red-500" />
                              )}
                            </div>
                          </TableCell>
                          <TableCell>
                            <Badge className={getStatusColor(equipment.status)}>
                              {translateEquipmentStatus(equipment.status)}
                            </Badge>
                          </TableCell>
                          <TableCell className="text-right">
                            <Button variant="ghost" size="icon" onClick={() => viewEquipmentDetails(equipment)}>
                              <Eye className="h-4 w-4" />
                            </Button>
                          </TableCell>
                        </TableRow>
                      );
                    })
                  )}
                </TableBody>
              </Table>
            </div>
          </CardContent>
          <CardFooter className="flex justify-between">
            <div className="text-sm text-gray-500">
              Mostrando {filteredEquipments.length} de {equipments.length} equipamentos
            </div>
            <Button variant="outline" size="sm">
              <Download className="h-4 w-4 mr-2" />
              Exportar Lista
            </Button>
          </CardFooter>
        </Card>

        {/* Card de Resumo */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <Card>
            <CardHeader className="pb-2">
              <CardTitle className="text-lg">Equipamentos Operacionais</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-3xl font-bold">
                {equipments.filter(e => e.status === 'operational').length}
              </div>
              <div className="text-sm text-gray-500">
                de {equipments.length} equipamentos
              </div>
            </CardContent>
          </Card>
          
          <Card>
            <CardHeader className="pb-2">
              <CardTitle className="text-lg">Manuten√ß√µes Pendentes</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-3xl font-bold">
                {equipments.filter(e => {
                  const nextMaintenanceDate = new Date(e.nextMaintenance);
                  const today = new Date();
                  return nextMaintenanceDate <= today;
                }).length}
              </div>
              <div className="text-sm text-gray-500">
                equipamentos precisam de aten√ß√£o
              </div>
            </CardContent>
          </Card>
          
          <Card>
            <CardHeader className="pb-2">
              <CardTitle className="text-lg">Pr√≥ximas Calibra√ß√µes</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="text-3xl font-bold">
                {equipments.filter(e => {
                  const nextCalibrationDate = new Date(e.nextCalibration);
                  const thirtyDaysFromNow = new Date();
                  thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);
                  return nextCalibrationDate <= thirtyDaysFromNow;
                }).length}
              </div>
              <div className="text-sm text-gray-500">
                nos pr√≥ximos 30 dias
              </div>
            </CardContent>
          </Card>
        </div>
      </div>

      {/* Di√°logo para adicionar novo equipamento */}
      <Dialog open={showNewEquipmentDialog} onOpenChange={setShowNewEquipmentDialog}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle>Adicionar Novo Equipamento</DialogTitle>
            <DialogDescription>
              Preencha os dados para registrar um novo equipamento no sistema
            </DialogDescription>
          </DialogHeader>
          
          <form onSubmit={handleAddEquipment} className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="equipmentName">Nome do Equipamento</Label>
              <Input id="equipmentName" placeholder="Ex: HPLC-01" required />
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="equipmentType">Tipo</Label>
                <Select defaultValue="hplc">
                  <SelectTrigger id="equipmentType">
                    <SelectValue placeholder="Selecione o tipo" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="hplc">HPLC</SelectItem>
                    <SelectItem value="gc">Cromat√≥grafo de G√°s</SelectItem>
                    <SelectItem value="spectrometer">Espectr√¥metro</SelectItem>
                    <SelectItem value="scale">Balan√ßa</SelectItem>
                    <SelectItem value="microscope">Microsc√≥pio</SelectItem>
                    <SelectItem value="centrifuge">Centr√≠fuga</SelectItem>
                    <SelectItem value="other">Outro</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="equipmentStatus">Status</Label>
                <Select defaultValue="operational">
                  <SelectTrigger id="equipmentStatus">
                    <SelectValue placeholder="Selecione o status" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="operational">Operacional</SelectItem>
                    <SelectItem value="maintenance">Em Manuten√ß√£o</SelectItem>
                    <SelectItem value="calibration">Em Calibra√ß√£o</SelectItem>
                    <SelectItem value="out_of_service">Fora de Servi√ßo</SelectItem>
                    <SelectItem value="repair">Em Reparo</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="model">Modelo</Label>
              <Input id="model" placeholder="Ex: Agilent 1260" required />
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="serialNumber">N√∫mero de S√©rie</Label>
              <Input id="serialNumber" placeholder="Ex: SN12345678" required />
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="manufacturer">Fabricante</Label>
              <Input id="manufacturer" placeholder="Ex: Agilent Technologies" required />
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="acquisitionDate">Data de Aquisi√ß√£o</Label>
                <Input id="acquisitionDate" type="date" required />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="location">Localiza√ß√£o</Label>
                <Input id="location" placeholder="Ex: Sala 101" required />
              </div>
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="lastCalibration">√öltima Calibra√ß√£o</Label>
                <Input id="lastCalibration" type="date" required />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="nextCalibration">Pr√≥xima Calibra√ß√£o</Label>
                <Input id="nextCalibration" type="date" required />
              </div>
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="lastMaintenance">√öltima Manuten√ß√£o</Label>
                <Input id="lastMaintenance" type="date" required />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="nextMaintenance">Pr√≥xima Manuten√ß√£o</Label>
                <Input id="nextMaintenance" type="date" required />
              </div>
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="responsible">Respons√°vel</Label>
              <Input id="responsible" placeholder="Nome do respons√°vel pelo equipamento" required />
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="notes">Observa√ß√µes</Label>
              <textarea 
                id="notes" 
                className="w-full min-h-[80px] rounded-md border border-input p-2"
                placeholder="Observa√ß√µes adicionais sobre o equipamento"
              ></textarea>
            </div>
            
            <DialogFooter>
              <Button type="button" variant="outline" onClick={() => setShowNewEquipmentDialog(false)}>
                Cancelar
              </Button>
              <Button type="submit">Adicionar Equipamento</Button>
            </DialogFooter>
          </form>
        </DialogContent>
      </Dialog>

      {/* Di√°logo para detalhes do equipamento */}
      {selectedEquipment && (
        <Dialog open={showEquipmentDetailDialog} onOpenChange={setShowEquipmentDetailDialog}>
          <DialogContent className="max-w-3xl">
            <DialogHeader>
              <DialogTitle>Detalhes do Equipamento</DialogTitle>
              <DialogDescription>
                Informa√ß√µes detalhadas sobre {selectedEquipment.name}
              </DialogDescription>
            </DialogHeader>
            
            <Tabs defaultValue="info">
              <TabsList>
                <TabsTrigger value="info">Informa√ß√µes</TabsTrigger>
                <TabsTrigger value="maintenance">Manuten√ß√µes</TabsTrigger>
                <TabsTrigger value="documents">Documentos</TabsTrigger>
              </TabsList>
              
              <TabsContent value="info" className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                  <div className="space-y-3">
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Nome</h3>
                      <p className="text-lg">{selectedEquipment.name}</p>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Tipo</h3>
                      <p className="text-lg">{translateEquipmentType(selectedEquipment.type)}</p>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Modelo</h3>
                      <p className="text-lg">{selectedEquipment.model}</p>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">N√∫mero de S√©rie</h3>
                      <p className="text-lg">{selectedEquipment.serialNumber}</p>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Fabricante</h3>
                      <p className="text-lg">{selectedEquipment.manufacturer}</p>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Localiza√ß√£o</h3>
                      <p className="text-lg">{selectedEquipment.location}</p>
                    </div>
                  </div>
                  
                  <div className="space-y-3">
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Status</h3>
                      <Badge className={getStatusColor(selectedEquipment.status)}>
                        {translateEquipmentStatus(selectedEquipment.status)}
                      </Badge>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Data de Aquisi√ß√£o</h3>
                      <p className="text-lg">{new Date(selectedEquipment.acquisitionDate).toLocaleDateString('pt-BR')}</p>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">√öltima Calibra√ß√£o</h3>
                      <p className="text-lg">{new Date(selectedEquipment.lastCalibration).toLocaleDateString('pt-BR')}</p>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Pr√≥xima Calibra√ß√£o</h3>
                      <div className="flex items-center">
                        <p className="text-lg">{new Date(selectedEquipment.nextCalibration).toLocaleDateString('pt-BR')}</p>
                        {getMaintenanceAlertStatus(selectedEquipment.nextCalibration) === 'overdue' && (
                          <AlertCircle className="h-4 w-4 ml-2 text-red-500" />
                        )}
                      </div>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">√öltima Manuten√ß√£o</h3>
                      <p className="text-lg">{new Date(selectedEquipment.lastMaintenance).toLocaleDateString('pt-BR')}</p>
                    </div>
                    
                    <div>
                      <h3 className="text-sm font-medium text-gray-500">Pr√≥xima Manuten√ß√£o</h3>
                      <div className="flex items-center">
                        <p className="text-lg">{new Date(selectedEquipment.nextMaintenance).toLocaleDateString('pt-BR')}</p>
                        {getMaintenanceAlertStatus(selectedEquipment.nextMaintenance) === 'overdue' && (
                          <AlertCircle className="h-4 w-4 ml-2 text-red-500" />
                        )}
                      </div>
                    </div>
                  </div>
                </div>
                
                <div className="mt-4">
                  <h3 className="text-sm font-medium text-gray-500">Respons√°vel</h3>
                  <p className="text-lg">{selectedEquipment.responsible}</p>
                </div>
                
                {selectedEquipment.notes && (
                  <div className="mt-4">
                    <h3 className="text-sm font-medium text-gray-500">Observa√ß√µes</h3>
                    <p className="text-lg">{selectedEquipment.notes}</p>
                  </div>
                )}
              </TabsContent>
              
              <TabsContent value="maintenance">
                <div className="py-4">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-medium">Hist√≥rico de Manuten√ß√µes</h3>
                    <Button 
                      size="sm" 
                      onClick={() => {
                        setShowNewMaintenanceDialog(true);
                      }}
                    >
                      <Plus className="h-4 w-4 mr-2" />
                      Agendar Manuten√ß√£o
                    </Button>
                  </div>
                  
                  {equipmentMaintenanceRecords.length === 0 ? (
                    <div className="text-center py-8 border rounded-md">
                      <div className="flex flex-col items-center">
                        <Wrench className="h-10 w-10 text-gray-400 mb-2" />
                        <h3 className="text-lg font-medium">Nenhum Registro</h3>
                        <p className="text-gray-500 max-w-md mt-1">
                          N√£o h√° registros de manuten√ß√£o para este equipamento.
                        </p>
                      </div>
                    </div>
                  ) : (
                    <div className="border rounded-md overflow-hidden">
                      <Table>
                        <TableHeader>
                          <TableRow>
                            <TableHead>Data</TableHead>
                            <TableHead>Tipo</TableHead>
                            <TableHead>Descri√ß√£o</TableHead>
                            <TableHead>T√©cnico</TableHead>
                            <TableHead>Status</TableHead>
                            <TableHead className="text-right">A√ß√µes</TableHead>
                          </TableRow>
                        </TableHeader>
                        <TableBody>
                          {equipmentMaintenanceRecords.map((record) => (
                            <TableRow key={record.id}>
                              <TableCell>{new Date(record.date).toLocaleDateString('pt-BR')}</TableCell>
                              <TableCell>{translateMaintenanceType(record.type)}</TableCell>
                              <TableCell>{record.description}</TableCell>
                              <TableCell>{record.technician}</TableCell>
                              <TableCell>
                                <Badge
                                  className={
                                    record.status === 'completed' ? 'bg-green-500' :
                                    record.status === 'in_progress' ? 'bg-blue-500' :
                                    record.status === 'scheduled' ? 'bg-yellow-500' :
                                    'bg-gray-500'
                                  }
                                >
                                  {translateMaintenanceStatus(record.status)}
                                </Badge>
                              </TableCell>
                              <TableCell className="text-right">
                                <Button variant="ghost" size="sm">Ver</Button>
                              </TableCell>
                            </TableRow>
                          ))}
                        </TableBody>
                      </Table>
                    </div>
                  )}
                </div>
              </TabsContent>
              
              <TabsContent value="documents">
                <div className="py-4">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-medium">Documentos</h3>
                    <Button variant="outline" size="sm">
                      <Plus className="h-4 w-4 mr-2" />
                      Adicionar Documento
                    </Button>
                  </div>
                  
                  <div className="text-center py-8 border rounded-md">
                    <div className="flex flex-col items-center">
                      <div className="h-10 w-10 text-gray-400 mb-2">üìÑ</div>
                      <h3 className="text-lg font-medium">Documentos do Equipamento</h3>
                      <p className="text-gray-500 max-w-md mt-1">
                        Aqui voc√™ pode gerenciar manuais, certificados e outros documentos relacionados ao equipamento.
                      </p>
                    </div>
                  </div>
                </div>
              </TabsContent>
            </Tabs>
            
            <DialogFooter className="gap-2">
              <Button variant="outline" onClick={() => setShowEquipmentDetailDialog(false)}>
                Fechar
              </Button>
              <Button>
                <Edit className="h-4 w-4 mr-2" />
                Editar Equipamento
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>
      )}

      {/* Di√°logo para adicionar nova manuten√ß√£o */}
      <Dialog open={showNewMaintenanceDialog} onOpenChange={setShowNewMaintenanceDialog}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle>Agendar Manuten√ß√£o</DialogTitle>
            <DialogDescription>
              {selectedEquipment && `Agende uma nova manuten√ß√£o para ${selectedEquipment.name}`}
            </DialogDescription>
          </DialogHeader>
          
          <form onSubmit={handleAddMaintenance} className="space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="maintenanceType">Tipo de Manuten√ß√£o</Label>
                <Select defaultValue="preventive">
                  <SelectTrigger id="maintenanceType">
                    <SelectValue placeholder="Selecione o tipo" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="calibration">Calibra√ß√£o</SelectItem>
                    <SelectItem value="preventive">Preventiva</SelectItem>
                    <SelectItem value="corrective">Corretiva</SelectItem>
                    <SelectItem value="validation">Valida√ß√£o</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="maintenanceDate">Data</Label>
                <Input id="maintenanceDate" type="date" required />
              </div>
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="maintenanceDescription">Descri√ß√£o</Label>
              <Input id="maintenanceDescription" placeholder="Descri√ß√£o da manuten√ß√£o" required />
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="maintenanceTechnician">T√©cnico Respons√°vel</Label>
              <Input id="maintenanceTechnician" placeholder="Nome do t√©cnico" required />
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="maintenanceStatus">Status</Label>
                <Select defaultValue="scheduled">
                  <SelectTrigger id="maintenanceStatus">
                    <SelectValue placeholder="Selecione o status" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="scheduled">Agendada</SelectItem>
                    <SelectItem value="in_progress">Em Andamento</SelectItem>
                    <SelectItem value="completed">Conclu√≠da</SelectItem>
                    <SelectItem value="canceled">Cancelada</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="maintenanceCost">Custo (R$)</Label>
                <Input id="maintenanceCost" type="number" step="0.01" placeholder="0,00" />
              </div>
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="maintenanceNotes">Observa√ß√µes</Label>
              <textarea 
                id="maintenanceNotes" 
                className="w-full min-h-[80px] rounded-md border border-input p-2"
                placeholder="Observa√ß√µes adicionais sobre a manuten√ß√£o"
              ></textarea>
            </div>
            
            <DialogFooter>
              <Button type="button" variant="outline" onClick={() => setShowNewMaintenanceDialog(false)}>
                Cancelar
              </Button>
              <Button type="submit">Agendar</Button>
            </DialogFooter>
          </form>
        </DialogContent>
      </Dialog>
  );
}

// Dados fict√≠cios para desenvolvimento
const mockEquipments: Equipment[] = [
  {
    id: 1,
    name: 'HPLC-01',
    type: 'hplc',
    model: 'Agilent 1260 Infinity II',
    serialNumber: 'SGAHS87456',
    manufacturer: 'Agilent Technologies',
    acquisitionDate: '2023-05-15',
    lastCalibration: '2025-03-15',
    nextCalibration: '2025-09-15',
    lastMaintenance: '2025-02-10',
    nextMaintenance: '2025-05-10',
    location: 'Sala 101 - √Årea de An√°lises',
    status: 'operational',
    responsible: 'Ana Silva',
    notes: 'Equipamento principal para an√°lise de canabinoides.'
  },
  {
    id: 2,
    name: 'GC-MS-01',
    type: 'gc',
    model: 'Shimadzu GCMS-QP2020 NX',
    serialNumber: 'JH52645789',
    manufacturer: 'Shimadzu',
    acquisitionDate: '2023-08-20',
    lastCalibration: '2025-02-20',
    nextCalibration: '2025-08-20',
    lastMaintenance: '2025-03-05',
    nextMaintenance: '2025-06-05',
    location: 'Sala 102 - √Årea de An√°lises',
    status: 'operational',
    responsible: 'Carlos Mendes'
  },
  {
    id: 3,
    name: 'Balan√ßa Anal√≠tica',
    type: 'scale',
    model: 'Mettler Toledo XPE205',
    serialNumber: 'BL21354687',
    manufacturer: 'Mettler Toledo',
    acquisitionDate: '2024-01-10',
    lastCalibration: '2025-04-10',
    nextCalibration: '2025-05-10',
    lastMaintenance: '2025-04-10',
    nextMaintenance: '2025-07-10',
    location: 'Sala 101 - √Årea de Preparo',
    status: 'operational',
    responsible: 'Mariana Costa'
  },
  {
    id: 4,
    name: 'Microsc√≥pio √ìptico',
    type: 'microscope',
    model: 'Zeiss Axio Scope.A1',
    serialNumber: 'MS78945612',
    manufacturer: 'Zeiss',
    acquisitionDate: '2023-11-15',
    lastCalibration: '2025-02-15',
    nextCalibration: '2025-08-15',
    lastMaintenance: '2025-02-15',
    nextMaintenance: '2025-08-15',
    location: 'Sala 103 - Laborat√≥rio de Microbiologia',
    status: 'maintenance',
    responsible: 'Pedro Alves',
    notes: 'Em manuten√ß√£o preventiva programada.'
  },
  {
    id: 5,
    name: 'Centr√≠fuga',
    type: 'centrifuge',
    model: 'Eppendorf 5430R',
    serialNumber: 'CF45678912',
    manufacturer: 'Eppendorf',
    acquisitionDate: '2024-03-05',
    lastCalibration: '2025-03-05',
    nextCalibration: '2025-09-05',
    lastMaintenance: '2025-03-05',
    nextMaintenance: '2025-09-05',
    location: 'Sala 101 - √Årea de Preparo',
    status: 'operational',
    responsible: 'Mariana Costa'
  },
  {
    id: 6,
    name: 'ICP-MS',
    type: 'spectrometer',
    model: 'Thermo Scientific iCAP RQ',
    serialNumber: 'ICP87632145',
    manufacturer: 'Thermo Fisher Scientific',
    acquisitionDate: '2023-10-01',
    lastCalibration: '2025-01-10',
    nextCalibration: '2025-07-10',
    lastMaintenance: '2025-01-10',
    nextMaintenance: '2025-04-10',
    location: 'Sala 104 - An√°lises Elementares',
    status: 'out_of_service',
    responsible: 'Carlos Mendes',
    notes: 'Fora de servi√ßo aguardando pe√ßa de reposi√ß√£o.'
  },
  {
    id: 7,
    name: 'HPLC-02',
    type: 'hplc',
    model: 'Agilent 1290 Infinity II',
    serialNumber: 'SGHJ87235',
    manufacturer: 'Agilent Technologies',
    acquisitionDate: '2024-02-15',
    lastCalibration: '2025-03-25',
    nextCalibration: '2025-09-25',
    lastMaintenance: '2025-03-25',
    nextMaintenance: '2025-09-25',
    location: 'Sala 101 - √Årea de An√°lises',
    status: 'calibration',
    responsible: 'Ana Silva'
  }
];

// Dados fict√≠cios de registros de manuten√ß√£o
const mockMaintenanceRecords: MaintenanceRecord[] = [
  {
    id: 1,
    equipmentId: 1,
    date: '2025-02-10',
    type: 'preventive',
    description: 'Manuten√ß√£o preventiva semestral',
    technician: 'T√©cnico Agilent',
    status: 'completed',
    cost: 800,
    nextDate: '2025-08-10'
  },
  {
    id: 2,
    equipmentId: 1,
    date: '2024-08-15',
    type: 'calibration',
    description: 'Calibra√ß√£o completa do sistema',
    technician: 'T√©cnico Agilent',
    status: 'completed',
    cost: 1200,
    nextDate: '2025-02-15'
  },
  {
    id: 3,
    equipmentId: 2,
    date: '2025-03-05',
    type: 'preventive',
    description: 'Verifica√ß√£o e limpeza do sistema',
    technician: 'T√©cnico Shimadzu',
    status: 'completed',
    cost: 600
  },
  {
    id: 4,
    equipmentId: 3,
    date: '2025-04-10',
    type: 'calibration',
    description: 'Calibra√ß√£o de rotina',
    technician: 'T√©cnico Mettler',
    status: 'completed',
    cost: 400,
    nextDate: '2025-10-10'
  },
  {
    id: 5,
    equipmentId: 4,
    date: '2025-04-22',
    type: 'corrective',
    description: 'Substitui√ß√£o de lente com defeito',
    technician: 'T√©cnico Zeiss',
    status: 'in_progress'
  },
  {
    id: 6,
    equipmentId: 1,
    date: '2025-05-15',
    type: 'preventive',
    description: 'Manuten√ß√£o preventiva programada',
    technician: 'T√©cnico Agilent',
    status: 'scheduled',
    nextDate: '2025-11-15'
  }
];